<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags - URL Shortening Focus -->
    <title>SnapIT URL - URL Shortener with QR Codes & Analytics</title>
    <meta name="description" content="URL shortening platform with dynamic QR codes, static QR codes, custom aliases, bulk generation, click tracking, and real-time analytics. Password protection, expiration dates, and custom branding included.">
    <meta name="keywords" content="URL shortener, dynamic QR codes, static QR codes, custom QR codes, bulk QR codes, short URLs, link shortener, click tracking, URL analytics, branded links, link tracking, QR code generator, link management, custom aliases">
    <meta name="author" content="SnapIT Software">

    <!-- Open Graph - URL Focus -->
    <meta property="og:title" content="SnapIT URL - URL Shortener & QR Code Platform">
    <meta property="og:description" content="URL shortening and QR code platform. Dynamic QR codes, bulk generation, custom aliases, click tracking, and real-time analytics. Password protection and custom branding available.">
    <meta property="og:image" content="https://snapiturl.com/og-image.png">
    <meta property="og:url" content="https://snapiturl.com">
    <meta property="og:type" content="website">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="icon" type="image/png" href="/favicon.png">

    <!-- Relaxed CSP to prevent unnecessary blocking -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https: data: blob:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https: data: blob:; style-src 'self' 'unsafe-inline' https: data:; connect-src 'self' https: wss: data:; font-src 'self' https: data:; img-src 'self' https: data: blob:; frame-src 'self' https:; media-src 'self' https: data: blob:; object-src 'none'; base-uri 'self';"

    <!-- Preconnects -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://accounts.google.com">
    <link rel="preconnect" href="https://api.snapitqr.com">
    <link rel="preconnect" href="https://api.snapiturl.com">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Configuration (must be loaded first) -->
    <script src="config.js"></script>

    <!-- External Scripts -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- Stripe for payment processing -->
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

    <!-- Minimal Error Logging -->
    <script>
    (function() {
        'use strict';

        // Simple console log for initialization
        console.log('SnapIT URL - Application Initializing');

        // Payment system status
        window.addEventListener('load', function() {
            setTimeout(function() {
                console.log('💳 Payment system initialized');
            }, 2000);
        });
    })();
    </script>

    <style>
        :root {
            /* SnapIT Brand Colors - Match SnapIT Polls, Burn, Forums */
            --primary: #E91E63;
            --primary-gradient: linear-gradient(135deg, #E91E63 0%, #C2185B 100%);
            --primary-solid: #E91E63;
            --primary-dark: #C2185B;
            --primary-light: #F06292;
            --secondary: #000000;
            --accent: #FFF9C4;
            --accent-dark: #FFF59D;

            /* Status Colors */
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;

            /* Neutral Colors */
            --white: #ffffff;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3af;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);

            /* Border Radius */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;

            /* Spacing */
            --space-2: 0.5rem;
            --space-4: 1rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;

            /* Typography */
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background: #FFF5F7;
            background-size: 400% 400%;
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Glass Morphism Overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(2px);
            pointer-events: none;
            z-index: 1;
        }

        .container {
            position: relative;
            z-index: 2;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--space-4);
        }

        /* Professional Top Navigation */
        .header {
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            box-shadow: var(--shadow-2xl);
            padding: var(--space-4) var(--space-6);
            transition: all 0.3s ease;
            width: auto;
            max-width: calc(100vw - 2rem);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--space-6);
            white-space: nowrap;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: var(--space-2);
            flex-shrink: 0;
        }

        .logo::before {
            content: "🔗";
            font-size: 1.5rem;
            background: var(--primary);
            border-radius: var(--radius-lg);
            padding: 0.25rem;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            flex-wrap: wrap;
        }

        .nav-link {
            color: var(--gray-600);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s;
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-lg);
            white-space: nowrap;
        }

        .nav-link:hover {
            color: var(--primary-solid);
            background: rgba(170, 51, 106, 0.1);
            transform: translateY(-1px);
        }

        /* Responsive floating nav */
        @media (max-width: 768px) {
            .header {
                top: var(--space-2);
                padding: var(--space-3) var(--space-4);
                max-width: calc(100vw - 1rem);
            }

            .header-content {
                gap: var(--space-3);
            }

            .nav-menu {
                gap: var(--space-2);
            }

            .nav-link {
                font-size: 0.8rem;
                padding: var(--space-1) var(--space-2);
            }

            .logo {
                font-size: 1.25rem;
            }
        }

        /* Hero Section */
        .hero {
            padding: var(--space-20) 0 var(--space-16);
            text-align: center;
        }

        .hero h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 900;
            color: #1e293b;
            margin-bottom: var(--space-6);
            line-height: 1.1;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--gray-600);
            max-width: 600px;
            margin: 0 auto var(--space-8);
            font-weight: 400;
        }

        .hero-features {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: var(--space-6);
            margin-bottom: var(--space-12);
        }

        .hero-feature {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            background: var(--accent);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-xl);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Glass Cards */
        .glass-card {
            background: var(--accent);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-2xl);
            padding: var(--space-8);
            margin-bottom: var(--space-8);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-8);
            margin-bottom: var(--space-12);
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
                gap: var(--space-6);
            }
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }

        .card-icon {
            width: 3rem;
            height: 3rem;
            background: var(--primary);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin: 0;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: var(--space-6);
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: var(--space-2);
            font-size: 0.9rem;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: var(--space-4);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            font-family: var(--font-family);
            transition: all 0.2s;
            background: var(--accent);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary-solid);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: var(--accent);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-4) var(--space-6);
            border: none;
            border-radius: var(--radius-lg);
            font-size: 1rem;
            font-weight: 600;
            font-family: var(--font-family);
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-xl);
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            color: var(--gray-700);
            border: 2px solid var(--gray-300);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--accent);
            border-color: var(--primary-solid);
            color: var(--primary-solid);
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success);
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .btn-full {
            width: 100%;
        }

        .btn-lg {
            padding: var(--space-6) var(--space-8);
            font-size: 1.125rem;
        }

        /* Auth Section */
        .auth-section {
            text-align: center;
            padding: var(--space-8);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-xl);
            margin-bottom: var(--space-12);
        }

        .auth-section h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: var(--space-4);
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .auth-benefits {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: var(--space-4);
            margin-top: var(--space-6);
        }

        .auth-benefit {
            background: rgba(102, 126, 234, 0.1);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            color: var(--primary-dark);
        }

        /* Dashboard */
        .dashboard {
            display: none;
        }

        .dashboard.show {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .stat-card {
            background: var(--accent);
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: block;
        }

        .stat-label {
            color: var(--gray-600);
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* User Menu */
        .user-menu {
            display: none;
        }

        .user-menu.active {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--primary-solid);
        }

        .user-info {
            text-align: right;
        }

        .user-email {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .user-plan {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        /* URL Results */
        .url-result {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--success);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-top: var(--space-6);
            text-align: center;
        }

        .url-result h4 {
            color: var(--success);
            margin-bottom: var(--space-4);
            font-size: 1.125rem;
        }

        .shortened-url {
            background: var(--accent);
            border: 2px solid var(--success);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-4);
            flex-wrap: wrap;
            gap: var(--space-2);
        }

        .shortened-url-text {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--primary-solid);
            font-family: monospace;
            word-break: break-all;
        }

        /* URL List */
        .url-list {
            margin-top: var(--space-6);
        }

        .url-item {
            background: var(--accent);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-4);
            transition: all 0.2s;
        }

        .url-item:hover {
            border-color: var(--primary-solid);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .url-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-2);
            flex-wrap: wrap;
            gap: var(--space-2);
        }

        .url-short {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--primary-solid);
            font-family: monospace;
            word-break: break-all;
        }

        .url-clicks {
            font-size: 1rem;
            font-weight: 600;
            color: var(--success);
        }

        .url-original {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: var(--space-2);
            word-break: break-all;
        }

        .url-actions {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        /* Analytics Section */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .analytics-card {
            background: rgba(255, 255, 255, 0.9);
            padding: var(--space-6);
            border-radius: var(--radius-xl);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .analytics-card h4 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-600);
            margin-bottom: var(--space-2);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .analytics-value {
            font-size: 2rem;
            font-weight: 900;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Features Section */
        .features-section {
            padding: var(--space-20) 0;
        }

        .features-header {
            text-align: center;
            margin-bottom: var(--space-16);
        }

        .features-title {
            font-size: 2.5rem;
            font-weight: 900;
            margin-bottom: var(--space-4);
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--space-8);
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            text-align: center;
            transition: all 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-2xl);
        }

        .feature-icon {
            width: 4rem;
            height: 4rem;
            background: var(--primary);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            margin: 0 auto var(--space-4);
        }

        .feature-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
        }

        .feature-description {
            color: var(--gray-600);
            line-height: 1.6;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: var(--space-4);
            right: var(--space-4);
            background: var(--accent);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-xl);
            padding: var(--space-4) var(--space-6);
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s;
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            border-left: 4px solid var(--success);
        }

        .toast-error {
            border-left: 4px solid var(--error);
        }

        .toast-warning {
            border-left: 4px solid var(--warning);
        }

        .toast-info {
            border-left: 4px solid var(--info);
        }

        /* Responsive */
        @media (max-width: 640px) {
            .nav-menu {
                gap: var(--space-2);
            }

            .nav-link {
                padding: var(--space-2);
                font-size: 0.875rem;
            }

            .hero {
                padding: var(--space-12) 0 var(--space-8);
            }

            .glass-card {
                padding: var(--space-4);
            }

            .auth-benefits {
                flex-direction: column;
                align-items: center;
            }

            .shortened-url {
                flex-direction: column;
                align-items: stretch;
            }

            .url-actions {
                justify-content: center;
            }
        }

        /* Loading State */
        .loading {
            opacity: 0.7;
            pointer-events: none;
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--primary-solid);
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Upgrade Modal Styles */
        .upgrade-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            padding: var(--space-4);
        }

        .upgrade-modal.show {
            opacity: 1;
        }

        .upgrade-modal-content {
            background: var(--accent);
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            max-width: 1200px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-2xl);
        }

        .upgrade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-8);
            border-bottom: 2px solid var(--gray-100);
            padding-bottom: var(--space-4);
        }

        .upgrade-header h2 {
            font-size: 2rem;
            font-weight: 900;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--gray-400);
            padding: 0.5rem;
            border-radius: 50%;
            width: 3rem;
            height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-6);
        }

        .pricing-card {
            background: var(--accent);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
        }

        .pricing-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-solid);
        }

        .pricing-card.popular {
            border-color: var(--primary-solid);
            border-width: 3px;
            transform: scale(1.05);
        }

        .popular-badge {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .pricing-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: var(--space-4);
            color: var(--gray-900);
        }

        .pricing-card .price {
            font-size: 2.5rem;
            font-weight: 900;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-6);
        }

        .pricing-card .price span {
            font-size: 1rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        .pricing-card ul {
            list-style: none;
            padding: 0;
            margin: 0 0 var(--space-6) 0;
            text-align: left;
        }

        .pricing-card li {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--gray-100);
            font-size: 0.9rem;
            color: var(--gray-700);
        }

        .pricing-card li:last-child {
            border-bottom: none;
        }

        .billing-toggle {
            text-align: center;
            margin-bottom: 2rem;
        }

        .billing-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--gray-300);
            background: var(--accent);
            color: var(--gray-700);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: var(--font-family);
        }

        .billing-btn:first-child {
            border-radius: var(--radius-lg) 0 0 var(--radius-lg);
        }

        .billing-btn:last-child {
            border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
        }

        .billing-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary-solid);
        }

        @media (max-width: 768px) {
            .upgrade-modal-content {
                padding: var(--space-4);
                margin: var(--space-2);
            }

            .pricing-grid {
                grid-template-columns: 1fr;
            }

            .pricing-card.popular {
                transform: none;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-12) var(--space-4);
            color: var(--gray-500);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: var(--space-4);
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--space-2);
            color: var(--gray-700);
        }

        .empty-state-description {
            font-size: 0.9rem;
            color: var(--gray-500);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="https://snapiturl.com" class="logo">SnapIT URL</a>
                <nav class="nav-menu">
                    <a href="#features" class="nav-link">Features</a>
                    <a href="#pricing" class="nav-link">Pricing</a>
                    <a href="https://snapitqr.com" class="nav-link">QR Codes</a>

                    <!-- Auth Section -->
                    <div id="authSection" style="display: flex; align-items: center; gap: 1rem;">
                        <div id="signInButton" style="display: flex; align-items: center; gap: 0.5rem;">
                            <div id="g_id_signin"></div>
                            <!-- Custom backup sign-in button -->
                            <button id="customSignInBtn" class="btn-sign-in" onclick="showCustomSignIn()" style="
                                display: inline-flex;
                                align-items: center;
                                gap: 0.5rem;
                                padding: 0.625rem 1.25rem;
                                background: white;
                                color: #000;
                                border: 1px solid #E91E63;
                                border-radius: 0.5rem;
                                font-weight: 600;
                                font-size: 0.875rem;
                                cursor: pointer;
                                transition: all 0.2s;
                                white-space: nowrap;
                            " onmouseover="this.style.background='#FFF9C4'; this.style.borderColor='#C2185B';" onmouseout="this.style.background='white'; this.style.borderColor='#E91E63';">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                                </svg>
                                Sign In
                            </button>
                        </div>
                        <div id="userMenu" class="user-menu" style="display: none;">
                            <div class="user-info">
                                <div id="userEmail" class="user-email"></div>
                                <div id="userPlan" class="user-plan"></div>
                            </div>
                            <img id="userAvatar" class="user-avatar" alt="User">
                            <button class="btn btn-secondary" onclick="signOut()" style="padding: 0.5rem 1rem; font-size: 0.875rem;">Sign Out</button>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Hero Section -->
        <section class="hero">
            <h1>Powerful URL Shortener<br>with Advanced Analytics</h1>
            <p class="hero-subtitle">Create short, branded links with custom domains, detailed click tracking, and integrated QR code generation. Perfect for marketers and businesses.</p>

            <div class="hero-features">
                <div class="hero-feature">
                    <span>⚡</span>
                    <span>Instant Shortening</span>
                </div>
                <div class="hero-feature">
                    <span>📊</span>
                    <span>Click Analytics</span>
                </div>
                <div class="hero-feature">
                    <span>🎨</span>
                    <span>Custom Domains</span>
                </div>
                <div class="hero-feature">
                    <span>📱</span>
                    <span>QR Code Integration</span>
                </div>
            </div>
        </section>

        <!-- Auth Section -->
        <section class="auth-section" id="authCard">
            <h3>🚀 Unlock Premium URL Features</h3>
            <p style="color: var(--gray-600); margin-bottom: var(--space-6);">Sign in with Google to access custom domains, advanced analytics, and QR code integration</p>
            <div id="g_id_signin_alt" style="display: inline-block;"></div>

            <div class="auth-benefits">
                <div class="auth-benefit">🔗 Custom Domains</div>
                <div class="auth-benefit">📈 Click Analytics</div>
                <div class="auth-benefit">📱 QR Code Integration</div>
                <div class="auth-benefit">🎯 Link Management</div>
            </div>
        </section>

        <!-- Dashboard -->
        <section id="dashboard" class="dashboard glass-card">
            <div class="card-header">
                <div class="card-icon">📊</div>
                <h2 class="card-title">Your Dashboard</h2>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-value" id="urlCount">0</span>
                    <span class="stat-label">Short URLs Created</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="totalClicks">0</span>
                    <span class="stat-label">Total Clicks</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="currentPlan">Free</span>
                    <span class="stat-label">Current Plan</span>
                </div>
            </div>

            <div style="text-align: center; display: flex; gap: var(--space-4); justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="refreshDashboard()">🔄 Refresh Data</button>
                <button class="btn btn-primary" onclick="showUpgradeModal()">⭐ Upgrade Plan</button>
            </div>
        </section>

        <!-- Main Content Grid -->
        <div class="main-grid">
            <!-- URL Shortener -->
            <div class="glass-card">
                <div class="card-header">
                    <div class="card-icon">🎯</div>
                    <h2 class="card-title">URL Shortener</h2>
                </div>

                <p style="color: var(--gray-600); margin-bottom: var(--space-6); font-size: 0.9rem;">
                    Create short, memorable links that are easy to share and track.
                </p>

                <div class="form-group">
                    <label for="urlToShorten" class="form-label">Long URL</label>
                    <input type="url" id="urlToShorten" class="form-input" placeholder="https://example.com/very-long-url-that-needs-shortening">
                </div>

                <div class="form-group">
                    <label for="customAlias" class="form-label">Custom Alias (Optional)</label>
                    <input type="text" id="customAlias" class="form-input" placeholder="my-custom-link">
                    <small style="color: var(--gray-500); font-size: 0.875rem;">Leave empty for auto-generated code (letters, numbers, hyphens only)</small>
                </div>

                <div class="form-group">
                    <label for="domainSelect" class="form-label">Domain</label>
                    <select id="domainSelect" class="form-input" style="background-color: var(--accent);">
                        <option value="snapiturl.com">snapiturl.com</option>
                        <option value="snapitqr.com">snapitqr.com</option>
                    </select>
                    <small style="color: var(--gray-500); font-size: 0.875rem;">Choose your preferred domain for the short URL</small>
                </div>

                <button id="shortenBtn" class="btn btn-primary btn-full btn-lg" onclick="shortenURL()">
                    <span>🚀 Create Short URL</span>
                </button>

                <div id="urlResults"></div>
            </div>

            <!-- QR Code Integration -->
            <div class="glass-card">
                <div class="card-header">
                    <div class="card-icon">📱</div>
                    <h2 class="card-title">QR Code for Your Links</h2>
                </div>

                <p style="color: var(--gray-600); margin-bottom: var(--space-6); font-size: 0.9rem;">
                    Generate QR codes for your short URLs instantly using SnapIT QR service.
                </p>

                <div class="form-group">
                    <label for="qrUrlInput" class="form-label">Short URL or Custom URL</label>
                    <input type="url" id="qrUrlInput" class="form-input" placeholder="https://snapiturl.com/abc123">
                </div>

                <div class="form-group">
                    <label class="form-label">QR Code Size</label>
                    <select id="qrSize" class="form-select">
                        <option value="200">Small (200×200)</option>
                        <option value="300" selected>Medium (300×300)</option>
                        <option value="400">Large (400×400)</option>
                        <option value="500">Extra Large (500×500)</option>
                    </select>
                </div>

                <button id="generateQRBtn" class="btn btn-primary btn-full btn-lg" onclick="generateQRFromURL()">
                    <span>📱 Generate QR Code</span>
                </button>

                <div id="qrPreview" style="background: rgba(248, 250, 252, 0.8); border: 2px dashed var(--gray-300); border-radius: var(--radius-xl); padding: var(--space-8); text-align: center; margin-top: var(--space-6); min-height: 200px; display: flex; align-items: center; justify-content: center;">
                    <div style="color: var(--gray-500); font-size: 1.125rem; display: flex; flex-direction: column; align-items: center; gap: var(--space-2);">
                        <span style="font-size: 3rem; opacity: 0.5;">📱</span>
                        <span>QR code will appear here</span>
                    </div>
                </div>

                <div id="qrActions" style="display: none; flex-direction: row; flex-wrap: wrap; gap: var(--space-2); justify-content: center; margin-top: var(--space-4);">
                    <button class="btn btn-secondary" onclick="downloadQRCode()">💾 Download</button>
                    <button class="btn btn-secondary" onclick="shareQRCode()">📤 Share</button>
                </div>
            </div>
        </div>

        <!-- My Short URLs Section -->
        <section class="glass-card">
            <div class="card-header">
                <div class="card-icon">🔗</div>
                <h2 class="card-title">My Short URLs</h2>
            </div>

            <div id="urlListContainer">
                <div class="empty-state">
                    <div class="empty-state-icon">🔗</div>
                    <div class="empty-state-title">No short URLs yet</div>
                    <div class="empty-state-description">Create your first short URL above to get started!</div>
                </div>
            </div>
        </section>

        <!-- Analytics Section -->
        <section class="glass-card" id="analyticsSection" style="display: none;">
            <div class="card-header">
                <div class="card-icon">📈</div>
                <h2 class="card-title">Link Analytics</h2>
            </div>

            <div class="analytics-grid">
                <div class="analytics-card">
                    <h4>Total Clicks</h4>
                    <div class="analytics-value" id="analyticsClicks">0</div>
                </div>
                <div class="analytics-card">
                    <h4>Unique Visitors</h4>
                    <div class="analytics-value" id="analyticsVisitors">0</div>
                </div>
                <div class="analytics-card">
                    <h4>Click-Through Rate</h4>
                    <div class="analytics-value" id="analyticsCTR">0%</div>
                </div>
                <div class="analytics-card">
                    <h4>Avg. Daily Clicks</h4>
                    <div class="analytics-value" id="analyticsAvgDaily">0</div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="features-section">
            <div class="features-header">
                <h2 class="features-title">Powerful Features for Link Management</h2>
                <p style="font-size: 1.125rem; color: var(--gray-600); max-width: 600px; margin: 0 auto;">
                    Everything you need to create, track, and optimize your short links
                </p>
            </div>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">⚡</div>
                    <h3 class="feature-title">Lightning Fast</h3>
                    <p class="feature-description">Create short URLs instantly with our optimized global infrastructure and edge computing for fast redirects worldwide.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">📊</div>
                    <h3 class="feature-title">Advanced Analytics</h3>
                    <p class="feature-description">Track clicks, geographic data, device types, referrers, and user engagement with comprehensive real-time analytics dashboards.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🎨</div>
                    <h3 class="feature-title">Custom Domains</h3>
                    <p class="feature-description">Use your own branded domains for short links and create memorable, trustworthy URLs that match your business identity.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">📱</div>
                    <h3 class="feature-title">QR Code Integration</h3>
                    <p class="feature-description">Seamlessly generate QR codes for any short URL with SnapIT QR, combining link management with visual code tracking.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🔒</div>
                    <h3 class="feature-title">Enterprise Security</h3>
                    <p class="feature-description">Bank-level security with encrypted data storage, malware protection, GDPR compliance, and enterprise-grade privacy.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🚀</div>
                    <h3 class="feature-title">API Access</h3>
                    <p class="feature-description">Integrate URL shortening into your applications with our comprehensive REST API, webhooks, and developer tools.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🔗</div>
                    <h3 class="feature-title">Link Management</h3>
                    <p class="feature-description">Organize, edit, archive, and manage all your short links from a single powerful dashboard with bulk operations.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🎯</div>
                    <h3 class="feature-title">Campaign Tracking</h3>
                    <p class="feature-description">Track marketing campaigns with UTM parameters, conversion tracking, and A/B testing for optimized performance.</p>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🌍</div>
                    <h3 class="feature-title">Geo-Targeting</h3>
                    <p class="feature-description">Redirect users to different destinations based on their geographic location for localized marketing campaigns.</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer style="background: #000000; color: white; padding: var(--space-8) var(--space-4); margin-top: var(--space-20);">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-8); margin-bottom: var(--space-8);">
            <div>
                <h3 style="color: var(--primary); margin-bottom: var(--space-4); font-size: 1.25rem; font-weight: 700;">SNAPIT SUITE</h3>
                <p style="color: #CCCCCC; margin-bottom: var(--space-4); line-height: 1.6;">
                    Create and share short URLs instantly. Get real-time results and insights.
                </p>
                <div style="display: flex; gap: var(--space-2);">
                    <a href="https://snapitqr.com" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                        📱 QR Codes
                    </a>
                    <a href="https://snapitsaas.com" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                        💼 Enterprise
                    </a>
                </div>
            </div>

            <div>
                <h4 style="color: var(--primary); margin-bottom: var(--space-4); font-weight: 600;">TOOLS & UTILITIES</h4>
                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li style="margin-bottom: var(--space-2);">
                        <a href="https://snapiturl.com" style="color: #CCCCCC; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='#CCCCCC'">SnapIT URL</a>
                    </li>
                    <li style="margin-bottom: var(--space-2);">
                        <a href="https://snapitqr.com" style="color: #CCCCCC; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='#CCCCCC'">QR Code Generator</a>
                    </li>
                    <li style="margin-bottom: var(--space-2);">
                        <a href="https://snapitforms.com" style="color: #CCCCCC; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='#CCCCCC'">Form Builder</a>
                    </li>
                    <li style="margin-bottom: var(--space-2);">
                        <a href="https://snapitanalytics.com" style="color: #CCCCCC; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='#CCCCCC'">Analytics Platform</a>
                    </li>
                </ul>
            </div>

            <div>
                <h4 style="color: var(--primary); margin-bottom: var(--space-4); font-weight: 600;">Resources</h4>
                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li style="margin-bottom: var(--space-2);">
                        <a href="/api-docs" style="color: #CCCCCC; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='#CCCCCC'">API Documentation</a>
                    </li>
                    <li style="margin-bottom: var(--space-2);">
                        <a href="/help" style="color: #CCCCCC; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='#CCCCCC'">Help Center</a>
                    </li>
                    <li style="margin-bottom: var(--space-2);">
                        <a href="/tutorials" style="color: #CCCCCC; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='#CCCCCC'">Tutorials</a>
                    </li>
                    <li style="margin-bottom: var(--space-2);">
                        <a href="/blog" style="color: #CCCCCC; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='#CCCCCC'">Blog</a>
                    </li>
                </ul>
            </div>

            <div>
                <h4 style="color: var(--primary); margin-bottom: var(--space-4); font-weight: 600;">Support</h4>
                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li style="margin-bottom: var(--space-2);">
                        <a href="#" onclick="openFeedbackModal(); return false;" style="color: #CCCCCC; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='#CCCCCC'">Send Feedback</a>
                    </li>
                    <li style="margin-bottom: var(--space-2);">
                        <a href="/privacy" style="color: #CCCCCC; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='#CCCCCC'">Privacy Policy</a>
                    </li>
                    <li style="margin-bottom: var(--space-2);">
                        <a href="/terms" style="color: #CCCCCC; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='#CCCCCC'">Terms of Service</a>
                    </li>
                    <li style="margin-bottom: var(--space-2);">
                        <a href="/status" style="color: #CCCCCC; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='var(--primary)'" onmouseout="this.style.color='#CCCCCC'">Service Status</a>
                    </li>
                </ul>
            </div>
        </div>

        <div style="border-top: 1px solid var(--gray-200); padding-top: var(--space-6); text-align: center;">
            <p style="color: var(--gray-500); font-size: 0.875rem; margin: 0;">
                © 2025 SnapIT Software. All rights reserved. |
                <span style="color: var(--primary-solid); font-weight: 600;">Shared subscriptions across all SnapIT products</span>
            </p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Global variables
        let currentUser = null;
        let currentQR = null;
        let userUrls = [];

        // Initialize app
        window.onload = function() {
            console.log('SnapIT URL initializing...');
            checkExistingSession();
            initGoogleAuth();
            console.log('SnapIT URL initialized');
        };

        // Initialize Google Authentication with shared client ID
        function initGoogleAuth() {
            if (window.google && window.google.accounts) {
                window.google.accounts.id.initialize({
                    client_id: window.SNAPIT_CONFIG?.GOOGLE_CLIENT_ID || 'GOOGLE_CLIENT_ID_NOT_CONFIGURED',
                    callback: handleGoogleSignIn,
                    auto_select: false,
                    cancel_on_tap_outside: true
                });

                // Render sign-in buttons
                const signInElements = ['g_id_signin', 'g_id_signin_alt'];
                let googleButtonRendered = false;
                signInElements.forEach(elementId => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        window.google.accounts.id.renderButton(element, {
                            theme: 'outline',
                            size: 'large',
                            text: 'sign_in_with',
                            shape: 'rectangular'
                        });
                        googleButtonRendered = true;
                    }
                });

                // Hide custom button if Google button rendered successfully
                if (googleButtonRendered) {
                    const customBtn = document.getElementById('customSignInBtn');
                    if (customBtn) customBtn.style.display = 'none';
                }

                console.log('Google Sign-In initialized');
            } else {
                console.warn('Google Sign-In not available, retrying...');
                // Show custom button if Google fails after 3 seconds
                setTimeout(() => {
                    if (!window.google || !window.google.accounts) {
                        console.log('Google Sign-In failed to load - showing custom button');
                        const customBtn = document.getElementById('customSignInBtn');
                        if (customBtn) {
                            customBtn.style.display = 'inline-flex';
                            customBtn.title = 'Sign in to save and manage your short URLs';
                        }
                    } else {
                        initGoogleAuth(); // Retry once more
                    }
                }, 3000);
            }
        }

        // Handle Google Sign-In with unified backend authentication
        async function handleGoogleSignIn(response) {
            console.log('Google Sign-In response received');

            if (!response.credential) {
                showToast('No authentication credential received', 'error');
                return;
            }

            try {
                showToast('Authenticating...', 'info');

                // Use SnapIT URL authentication backend directly
                const authResponse = await fetch(`${window.SNAPIT_CONFIG.API_BASE_URL_SNAPITURL}/auth/google`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        token: response.credential,
                        action: 'login'
                    })
                });

                if (authResponse.ok) {
                    const authData = await authResponse.json();
                    if (authData.success) {
                        localStorage.setItem('snapiturl_token', authData.token);
                        localStorage.setItem('snapiturl_user', JSON.stringify(authData.user));

                        currentUser = authData.user;
                        updateAuthUI(authData.user);

                        showToast(`Welcome ${authData.user.name}!`, 'success');
                        refreshDashboard();
                        return;
                    }
                }

                showToast('Sign-in failed. Please try again.', 'error');
            } catch (error) {
                console.error('Authentication error:', error);
                showToast(`Sign-in failed: ${error.message}`, 'error');
            }
        }

        // Check for existing session (unified or local)
        function checkExistingSession() {
            // Check for unified authentication first
            const unifiedUserData = localStorage.getItem('snapit_user_data');
            const accessKey = localStorage.getItem('accessKey');

            if (unifiedUserData && accessKey) {
                try {
                    const user = JSON.parse(unifiedUserData);
                    currentUser = { ...user, accessKey: accessKey };
                    updateAuthUI(user);
                    console.log('Restored unified SnapIT session');
                    refreshDashboard();
                    return;
                } catch (error) {
                    console.error('Failed to restore unified session:', error);
                    localStorage.removeItem('snapit_user_data');
                    localStorage.removeItem('accessKey');
                }
            }

            // Fallback to local URL authentication
            const userData = localStorage.getItem('snapiturl_user');
            const authToken = localStorage.getItem('snapiturl_token');

            if (userData && authToken) {
                try {
                    const user = JSON.parse(userData);
                    currentUser = user;
                    updateAuthUI(user);
                    console.log('Restored local URL session');
                    refreshDashboard();
                } catch (error) {
                    console.error('Failed to restore local session:', error);
                    localStorage.removeItem('snapiturl_user');
                    localStorage.removeItem('snapiturl_token');
                }
            }
        }

        // Update UI for authenticated user
        function updateAuthUI(user) {
            currentUser = user;

            // Hide auth card and sign-in buttons
            document.getElementById('authCard').style.display = 'none';
            document.getElementById('signInButton').style.display = 'none';

            // Show user menu
            const userMenu = document.getElementById('userMenu');
            userMenu.style.display = 'flex';
            userMenu.classList.add('active');

            // Update user info
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userAvatar').src = user.picture;
            document.getElementById('userPlan').textContent = `${user.plan || 'Free'} Plan`;

            // Show dashboard
            document.getElementById('dashboard').classList.add('show');
        }

        // Show custom sign-in prompt
        function showCustomSignIn() {
            // Try to trigger Google One Tap if available
            if (window.google && window.google.accounts && window.google.accounts.id) {
                try {
                    window.google.accounts.id.prompt();
                } catch (error) {
                    console.warn('Google One Tap not available, showing auth card');
                }
            }

            // Scroll to auth card as fallback
            const authCard = document.getElementById('authCard');
            if (authCard) {
                authCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                authCard.style.animation = 'pulse 1s ease-in-out 2';
            }
        }

        // Sign out (unified)
        function signOut() {
            // Clear unified authentication
            localStorage.removeItem('accessKey');
            localStorage.removeItem('snapit_user_data');

            // Clear local authentication
            localStorage.removeItem('snapiturl_token');
            localStorage.removeItem('snapiturl_user');

            currentUser = null;
            userUrls = [];

            // Show auth card and sign-in button
            document.getElementById('authCard').style.display = 'block';
            document.getElementById('signInButton').style.display = 'flex';

            // Hide user menu and dashboard
            const userMenu = document.getElementById('userMenu');
            userMenu.style.display = 'none';
            userMenu.classList.remove('active');
            document.getElementById('dashboard').classList.remove('show');

            // Clear URL list
            document.getElementById('urlListContainer').innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">🔗</div>
                    <div class="empty-state-title">No short URLs yet</div>
                    <div class="empty-state-description">Create your first short URL above to get started!</div>
                </div>
            `;

            showToast('Signed out from SnapIT ecosystem', 'success');
        }

        // Shorten URL
        async function shortenURL() {
            const url = document.getElementById('urlToShorten').value.trim();
            const customAlias = document.getElementById('customAlias').value.trim();
            const selectedDomain = document.getElementById('domainSelect').value;

            if (!url) {
                showToast('Please enter a URL to shorten', 'error');
                return;
            }

            // Basic URL validation
            try {
                new URL(url);
            } catch (e) {
                showToast('Please enter a valid URL (include https://)', 'error');
                return;
            }

            const btn = document.getElementById('shortenBtn');
            btn.classList.add('loading');

            // Check authentication first
            if (!currentUser) {
                showToast('Please sign in to create short URLs', 'error');
                btn.classList.remove('loading');
                return;
            }

            try {
                const authToken = localStorage.getItem('accessKey') || localStorage.getItem('snapiturl_token');

                // Build request data
                const requestData = {
                    url: url,
                    domain: selectedDomain || 'snapiturl.com'
                };

                if (customAlias) {
                    // Basic validation for custom alias
                    if (!/^[a-zA-Z0-9-_]+$/.test(customAlias)) {
                        throw new Error('Custom alias can only contain letters, numbers, hyphens, and underscores');
                    }
                    requestData.customAlias = customAlias;
                }

                // Use appropriate API based on selected domain
                const apiEndpoint = selectedDomain === 'snapiturl.com'
                    ? 'https://api.snapiturl.com/url/shorten'
                    : 'https://api.snapitqr.com/url/shorten';

                // Build headers - include auth token if available (for tracked URLs)
                // If no token, backend creates anonymous URL
                const headers = {
                    'Content-Type': 'application/json'
                };

                if (authToken) {
                    headers['Authorization'] = `Bearer ${authToken}`;
                }

                const response = await fetch(apiEndpoint, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();

                if (result.success) {
                    // Normalize response format between different APIs
                    const normalizedResult = {
                        success: true,
                        shortUrl: result.shortUrl || result.url,
                        shortCode: result.shortCode || result.code,
                        originalUrl: result.originalUrl || result.targetUrl || url,
                        isAnonymous: !authToken
                    };

                    displayURLResult(normalizedResult);

                    // Show appropriate success message
                    if (!authToken) {
                        showToast('✅ Short URL created! Sign in to track analytics and manage your links.', 'success');
                    } else {
                        showToast('✅ URL shortened successfully! View analytics in your dashboard.', 'success');
                    }

                    // Clear inputs
                    document.getElementById('urlToShorten').value = '';
                    document.getElementById('customAlias').value = '';

                    // Refresh dashboard and URL list
                    refreshDashboard();
                } else {
                    throw new Error(result.error || 'Failed to shorten URL');
                }
            } catch (error) {
                console.error('URL shortening error:', error);
                showToast(`Failed to shorten URL: ${error.message}`, 'error');
            } finally {
                btn.classList.remove('loading');
            }
        }

        // Display URL shortening result
        function displayURLResult(data) {
            const resultsContainer = document.getElementById('urlResults');
            const shortUrl = data.shortUrl || data.url;
            const displayUrl = shortUrl || 'Error creating URL';

            resultsContainer.innerHTML = `
                <div class="url-result">
                    <h4>✅ Short URL Created!</h4>
                    <div class="shortened-url">
                        <span class="shortened-url-text">${displayUrl}</span>
                        <button class="btn btn-secondary" onclick="copyToClipboard('${displayUrl}')" style="padding: 0.5rem 1rem;">
                            📋 Copy
                        </button>
                    </div>
                    <div style="display: flex; gap: var(--space-2); justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="createQRFromURL('${displayUrl}')" style="padding: 0.5rem 1rem;">
                            📱 Create QR Code
                        </button>
                        <button class="btn btn-secondary" onclick="window.open('${displayUrl}', '_blank')" style="padding: 0.5rem 1rem;">
                            🔗 Test Link
                        </button>
                    </div>
                </div>
            `;
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!', 'success');
            }).catch(() => {
                showToast('Failed to copy', 'error');
            });
        }

        // Create QR code from URL
        function createQRFromURL(url) {
            document.getElementById('qrUrlInput').value = url;
            generateQRFromURL();
        }

        // Generate QR Code from URL
        function generateQRFromURL() {
            const url = document.getElementById('qrUrlInput').value.trim();

            if (!url) {
                showToast('Please enter a URL for QR code generation', 'error');
                return;
            }

            try {
                new URL(url);
            } catch (e) {
                showToast('Please enter a valid URL', 'error');
                return;
            }

            const btn = document.getElementById('generateQRBtn');
            btn.classList.add('loading');

            try {
                const size = parseInt(document.getElementById('qrSize').value) || 300;
                const container = document.getElementById('qrPreview');
                container.innerHTML = '';

                if (typeof QRious === 'undefined') {
                    container.innerHTML = '<div style="color: var(--gray-500); text-align: center;">❌ QR Code library not loaded</div>';
                    showToast('QR Code library failed to load', 'error');
                    return;
                }

                const canvas = document.createElement('canvas');
                container.appendChild(canvas);

                const qr = new QRious({
                    element: canvas,
                    value: url,
                    size: size,
                    background: '#FFFFFF',
                    foreground: '#000000',
                    level: 'H'
                });

                currentQR = {
                    url: url,
                    size: size,
                    dataURL: canvas.toDataURL()
                };

                document.getElementById('qrActions').style.display = 'flex';
                showToast('QR code generated successfully!', 'success');
            } catch (error) {
                console.error('QR generation error:', error);
                showToast('Failed to generate QR code', 'error');
            } finally {
                btn.classList.remove('loading');
            }
        }

        // Download QR Code
        function downloadQRCode() {
            try {
                const canvas = document.querySelector('#qrPreview canvas');

                if (!canvas) {
                    showToast('No QR code to download', 'error');
                    return;
                }

                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `snapit-url-qr-${Date.now()}.png`;
                    link.click();
                    URL.revokeObjectURL(url);
                    showToast('QR code downloaded!', 'success');
                }, 'image/png');
            } catch (error) {
                console.error('Download error:', error);
                showToast('Failed to download QR code', 'error');
            }
        }

        // Share QR Code
        function shareQRCode() {
            if (navigator.share) {
                navigator.share({
                    title: 'SnapIT URL QR Code',
                    text: 'Check out this QR code for my short URL!',
                    url: window.location.href
                }).catch(console.error);
            } else {
                showToast('Sharing not supported on this device', 'warning');
            }
        }

        // Refresh Dashboard
        async function refreshDashboard() {
            const authToken = localStorage.getItem('accessKey') || localStorage.getItem('snapiturl_token');

            if (!authToken || !currentUser) {
                return;
            }

            try {
                // Get short URLs from snapiturl API
                const urlResponse = await fetch('https://api.snapiturl.com/short-urls', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (urlResponse.ok) {
                    const urlData = await urlResponse.json();
                    userUrls = urlData.data?.shortUrls || urlData.shortUrls || [];

                    // Calculate stats
                    const totalUrls = userUrls.length;
                    const totalClicks = userUrls.reduce((sum, url) => sum + (url.clicks || 0), 0);

                    // Update dashboard
                    document.getElementById('urlCount').textContent = totalUrls;
                    document.getElementById('totalClicks').textContent = totalClicks.toLocaleString();

                    // Update URL list
                    displayURLList(userUrls);

                    // Update analytics if there are URLs
                    if (totalUrls > 0) {
                        updateAnalytics(userUrls);
                    }
                }

                // Get user plan info
                const dashboardResponse = await fetch('https://api.snapiturl.com/dashboard-data', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (dashboardResponse.ok) {
                    const dashboardData = await dashboardResponse.json();
                    const userPlan = dashboardData.data?.user?.subscription?.tier || 'free';
                    document.getElementById('currentPlan').textContent =
                        userPlan.charAt(0).toUpperCase() + userPlan.slice(1);
                }
            } catch (error) {
                console.error('Dashboard refresh error:', error);
            }
        }

        // Display URL List
        function displayURLList(urls) {
            const container = document.getElementById('urlListContainer');

            if (urls.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🔗</div>
                        <div class="empty-state-title">No short URLs yet</div>
                        <div class="empty-state-description">Create your first short URL above to get started!</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = urls.map(url => `
                <div class="url-item">
                    <div class="url-item-header">
                        <a href="${url.shortUrl || url.url}" target="_blank" class="url-short">${url.shortUrl || url.url}</a>
                        <span class="url-clicks">👁️ ${(url.clicks || 0).toLocaleString()} clicks</span>
                    </div>
                    <div class="url-original">🔗 ${url.originalUrl || url.targetUrl || 'N/A'}</div>
                    <div class="url-actions">
                        <button class="btn btn-secondary" onclick="copyToClipboard('${url.shortUrl || url.url}')" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                            📋 Copy
                        </button>
                        <button class="btn btn-secondary" onclick="createQRFromURL('${url.shortUrl || url.url}')" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                            📱 QR Code
                        </button>
                        <button class="btn btn-secondary" onclick="window.open('${url.shortUrl || url.url}', '_blank')" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                            🔗 Open
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Update Analytics
        function updateAnalytics(urls) {
            const totalClicks = urls.reduce((sum, url) => sum + (url.clicks || 0), 0);
            const uniqueVisitors = Math.floor(totalClicks * 0.7); // Estimate
            const avgDaily = Math.floor(totalClicks / Math.max(urls.length, 1));
            const ctr = urls.length > 0 ? ((totalClicks / urls.length) * 100).toFixed(1) : 0;

            document.getElementById('analyticsClicks').textContent = totalClicks.toLocaleString();
            document.getElementById('analyticsVisitors').textContent = uniqueVisitors.toLocaleString();
            document.getElementById('analyticsCTR').textContent = ctr + '%';
            document.getElementById('analyticsAvgDaily').textContent = avgDaily.toLocaleString();

            document.getElementById('analyticsSection').style.display = 'block';
        }

        // Stripe Configuration
        const STRIPE_CONFIG = {
            publishableKey: window.SNAPIT_CONFIG?.STRIPE_PUBLISHABLE_KEY || 'STRIPE_KEY_NOT_CONFIGURED',
            plans: window.SNAPIT_CONFIG?.STRIPE_PLANS || {}
        };

        // Show upgrade modal with pricing
        function showUpgradeModal() {
            const modal = document.createElement('div');
            modal.className = 'upgrade-modal';
            modal.innerHTML = `
                <div class="upgrade-modal-content">
                    <div class="upgrade-header">
                        <h2>🚀 Upgrade Your Plan</h2>
                        <button class="close-btn" onclick="this.closest('.upgrade-modal').remove()">×</button>
                    </div>

                    <div class="billing-toggle">
                        <button class="billing-btn active" data-period="monthly">Monthly</button>
                        <button class="billing-btn" data-period="yearly">Yearly <span style="color: #10b981;">(Save 20%)</span></button>
                    </div>

                    <div class="pricing-grid">
                        <div class="pricing-card">
                            <h3>FREE</h3>
                            <div class="price">$0<span>/forever</span></div>
                            <ul>
                                <li>✅ 20 Dynamic QR Codes</li>
                                <li>✅ 50 Short URLs</li>
                                <li>✅ 100 Form Responses/month</li>
                                <li>✅ Unlimited Static QR Codes</li>
                                <li>✅ Basic Analytics</li>
                            </ul>
                            <button class="btn btn-secondary" disabled>Current Plan</button>
                        </div>

                        <div class="pricing-card">
                            <h3>Starter</h3>
                            <div class="price" data-monthly="$3.99" data-yearly="$39.99">$3.99<span class="period">/month</span></div>
                            <ul>
                                <li>✅ 500 Dynamic QR Codes/month</li>
                                <li>✅ 1,000 Short URLs</li>
                                <li>✅ 1,000 Form Responses</li>
                                <li>✅ Advanced Customization</li>
                                <li>✅ Real-time Analytics</li>
                            </ul>
                            <button class="btn btn-primary" onclick="upgradeToplan('starter')">Choose Starter</button>
                        </div>

                        <div class="pricing-card popular">
                            <div class="popular-badge">Most Popular</div>
                            <h3>Professional</h3>
                            <div class="price" data-monthly="$9.99" data-yearly="$99.99">$9.99<span class="period">/month</span></div>
                            <ul>
                                <li>✅ 2,500 Dynamic QR Codes/month</li>
                                <li>✅ 5,000 Short URLs</li>
                                <li>✅ 5,000 Form Responses</li>
                                <li>✅ Full Branding Control</li>
                                <li>✅ Advanced Analytics</li>
                                <li>✅ API Access (Basic)</li>
                            </ul>
                            <button class="btn btn-primary" onclick="upgradeToplan('professional')">Choose Professional</button>
                        </div>

                        <div class="pricing-card">
                            <h3>Business</h3>
                            <div class="price" data-monthly="$29.99" data-yearly="$299.99">$29.99<span class="period">/month</span></div>
                            <ul>
                                <li>✅ 10,000 Dynamic QR Codes/month</li>
                                <li>✅ 25,000 Short URLs</li>
                                <li>✅ 25,000 Form Responses</li>
                                <li>✅ Team Collaboration (15 users)</li>
                                <li>✅ Custom Integrations</li>
                                <li>✅ Priority Support</li>
                            </ul>
                            <button class="btn btn-primary" onclick="upgradeToplan('business')">Choose Business</button>
                        </div>

                        <div class="pricing-card">
                            <h3>Premium</h3>
                            <div class="price" data-monthly="$49.99" data-yearly="$499.99">$49.99<span class="period">/month</span></div>
                            <ul>
                                <li>✅ 50,000 Dynamic QR Codes/month</li>
                                <li>✅ 100,000 Short URLs</li>
                                <li>✅ 100,000 Form Responses</li>
                                <li>✅ Advanced Team Features (50 users)</li>
                                <li>✅ 10 Custom Domains</li>
                                <li>✅ Dedicated Account Manager</li>
                            </ul>
                            <button class="btn btn-primary" onclick="upgradeToplan('premium')">Choose Premium</button>
                        </div>

                        <div class="pricing-card">
                            <h3>Enterprise</h3>
                            <div class="price" data-monthly="$99.99" data-yearly="$999.99">$99.99<span class="period">/month</span></div>
                            <ul>
                                <li>✅ Unlimited Dynamic QR Codes</li>
                                <li>✅ Unlimited Short URLs</li>
                                <li>✅ Unlimited Form Responses</li>
                                <li>✅ Unlimited Team Members</li>
                                <li>✅ Unlimited Custom Domains</li>
                                <li>✅ White-glove Onboarding</li>
                                <li>✅ 24/7 Dedicated Support</li>
                            </ul>
                            <button class="btn btn-primary" onclick="upgradeToplan('enterprise')">Choose Enterprise</button>
                        </div>
                    </div>

                </div>
            `;

            document.body.appendChild(modal);
            setTimeout(() => modal.classList.add('show'), 100);

            // Billing period toggle - add event listeners after modal is added to DOM
            modal.querySelectorAll('.billing-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    modal.querySelectorAll('.billing-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const period = this.dataset.period;
                    modal.querySelectorAll('.price').forEach(priceEl => {
                        const monthly = priceEl.dataset.monthly;
                        const yearly = priceEl.dataset.yearly;
                        if (monthly && yearly) {
                            priceEl.innerHTML = (period === 'monthly' ? monthly : yearly) +
                                '<span class="period">/' + (period === 'monthly' ? 'month' : 'year') + '</span>';
                        }
                    });
                });
            });
        }

        // Upgrade to specific plan
        async function upgradeToplan(planKey) {
            if (!currentUser) {
                showToast('Please sign in to upgrade your plan', 'error');
                return;
            }

            const plan = STRIPE_CONFIG.plans[planKey];
            if (!plan) {
                showToast('Invalid plan selected', 'error');
                return;
            }

            try {
                // Initialize Stripe if not already done
                if (!window.stripe) {
                    window.stripe = Stripe(STRIPE_CONFIG.publishableKey);
                }

                // Determine billing period (monthly or yearly)
                const billingPeriod = document.querySelector('.billing-btn.active')?.dataset.period || 'monthly';
                const priceId = billingPeriod === 'monthly' ? plan.monthlyPriceId : plan.yearlyPriceId;
                const amount = billingPeriod === 'monthly' ? plan.monthlyAmount : plan.yearlyAmount;

                showToast(`Redirecting to payment for ${plan.name} plan (${amount}/${billingPeriod})...`, 'info');

                // Call backend to create checkout session
                const response = await fetch('https://api.snapiturl.com/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        priceId: priceId,
                        userId: currentUser.sub || currentUser.id,
                        planName: plan.name,
                        billingPeriod: billingPeriod
                    })
                });

                const session = await response.json();

                if (session.sessionId) {
                    // Redirect to Stripe Checkout
                    const result = await window.stripe.redirectToCheckout({
                        sessionId: session.sessionId
                    });

                    if (result.error) {
                        showToast(`Payment error: ${result.error.message}`, 'error');
                    }
                } else {
                    throw new Error(session.error || 'Failed to create checkout session');
                }
            } catch (error) {
                console.error('Upgrade error:', error);
                showToast(`Upgrade failed: ${error.message}`, 'error');
            }
        }

        // Open feedback modal with Web3Forms
        function openFeedbackModal() {
            // Remove existing modal if any
            document.querySelectorAll('.modal-overlay').forEach(modal => modal.remove());

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-6);">
                        <h2 style="color: var(--gray-900); font-size: 1.75rem; font-weight: 700; margin: 0;">Send Feedback</h2>
                        <button onclick="this.closest('.modal-overlay').remove()" class="btn-close">×</button>
                    </div>

                    <p style="color: var(--gray-600); margin-bottom: var(--space-6);">
                        We'd love to hear your thoughts, suggestions, or concerns about SnapIT URL. Your feedback helps us improve!
                    </p>

                    <form action="https://api.web3forms.com/submit" method="POST" id="feedbackForm" style="display: flex; flex-direction: column; gap: var(--space-4);">
                        <input type="hidden" name="access_key" value="ebfa8f9b-ca95-40f0-abeb-23155a5a0c9c">
                        <input type="hidden" name="subject" value="SnapIT URL Feedback">
                        <input type="hidden" name="from_name" value="SnapIT URL Feedback Form">
                        <input type="hidden" name="redirect" value="https://snapiturl.com?feedback=success">

                        <div>
                            <label for="name" style="display: block; margin-bottom: var(--space-2); color: var(--gray-700); font-weight: 500;">Name</label>
                            <input type="text" id="name" name="name" required
                                   style="width: 100%; padding: var(--space-3); border: 2px solid var(--gray-300); border-radius: var(--border-radius); font-size: 1rem; transition: all 0.3s;"
                                   onfocus="this.style.borderColor='var(--primary)'" onblur="this.style.borderColor='var(--gray-300)'">
                        </div>

                        <div>
                            <label for="email" style="display: block; margin-bottom: var(--space-2); color: var(--gray-700); font-weight: 500;">Email</label>
                            <input type="email" id="email" name="email" required
                                   style="width: 100%; padding: var(--space-3); border: 2px solid var(--gray-300); border-radius: var(--border-radius); font-size: 1rem; transition: all 0.3s;"
                                   onfocus="this.style.borderColor='var(--primary)'" onblur="this.style.borderColor='var(--gray-300)'">
                        </div>

                        <div>
                            <label for="feedback_type" style="display: block; margin-bottom: var(--space-2); color: var(--gray-700); font-weight: 500;">Feedback Type</label>
                            <select id="feedback_type" name="feedback_type" required
                                    style="width: 100%; padding: var(--space-3); border: 2px solid var(--gray-300); border-radius: var(--border-radius); font-size: 1rem; transition: all 0.3s;"
                                    onfocus="this.style.borderColor='var(--primary)'" onblur="this.style.borderColor='var(--gray-300)'">
                                <option value="">Select feedback type...</option>
                                <option value="Feature Request">Feature Request</option>
                                <option value="Bug Report">Bug Report</option>
                                <option value="General Feedback">General Feedback</option>
                                <option value="Question">Question</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div>
                            <label for="message" style="display: block; margin-bottom: var(--space-2); color: var(--gray-700); font-weight: 500;">Message</label>
                            <textarea id="message" name="message" rows="6" required
                                      style="width: 100%; padding: var(--space-3); border: 2px solid var(--gray-300); border-radius: var(--border-radius); font-size: 1rem; resize: vertical; transition: all 0.3s;"
                                      onfocus="this.style.borderColor='var(--primary)'" onblur="this.style.borderColor='var(--gray-300)'"></textarea>
                        </div>

                        <div style="display: flex; gap: var(--space-3); justify-content: flex-end;">
                            <button type="button" onclick="this.closest('.modal-overlay').remove()" class="btn btn-secondary">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary" id="submitFeedback">
                                Send Feedback
                            </button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(modal);
            setTimeout(() => modal.classList.add('show'), 100);

            // Handle form submission
            document.getElementById('feedbackForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const submitBtn = document.getElementById('submitFeedback');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Sending...';
                submitBtn.disabled = true;

                try {
                    const formData = new FormData(this);
                    const response = await fetch('https://api.web3forms.com/submit', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await response.json();

                    if (result.success) {
                        modal.remove();
                        showToast('Thank you for your feedback! We will get back to you soon.', 'success');
                    } else {
                        throw new Error(result.message || 'Failed to send feedback');
                    }
                } catch (error) {
                    console.error('Feedback submission error:', error);
                    showToast('Failed to send feedback. Please try again.', 'error');
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            });
        }

        // Toast notification system
        function showToast(message, type = 'info', duration = 4000) {
            // Remove existing toasts
            document.querySelectorAll('.toast').forEach(toast => toast.remove());

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;

            const icons = {
                success: '✅',
                error: '❌',
                warning: '⚠️',
                info: 'ℹ️'
            };

            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: var(--space-2);">
                    <span style="font-size: 1.2rem;">${icons[type] || icons.info}</span>
                    <span style="flex: 1;">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()"
                            style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-400);">×</button>
                </div>
            `;

            document.body.appendChild(toast);

            // Show toast
            setTimeout(() => toast.classList.add('show'), 100);

            // Auto remove
            if (duration > 0) {
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.classList.remove('show');
                        setTimeout(() => toast.remove(), 300);
                    }
                }, duration);
            }
        }

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
</body>
</html>
